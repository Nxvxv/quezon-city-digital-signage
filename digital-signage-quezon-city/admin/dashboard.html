<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QC Library Digital Signage - Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb', // blue primary
                        secondary: '#6b7280', // gray text
                        accent: '#eab308',
                        danger: '#dc2626',
                        lightgray: '#f9fafb',
                        darkgray: '#374151'
                    },
                    fontFamily: {
                        montserrat: ['Montserrat', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        .loader {
            width: 45px;
            height: 40px;
            background: linear-gradient(#fff calc(1*100%/6),#ce0b22 0 calc(3*100%/6),#0000 0),
                        linear-gradient(#fff calc(2*100%/6),#0139a5 0 calc(4*100%/6),#0000 0),
                        linear-gradient(#fff calc(3*100%/6),#facf00 0 calc(5*100%/6),#0000 0);
            background-size: 10px 400%;
            background-repeat: no-repeat;
            animation: matrix 1s infinite linear;
        }

        @keyframes matrix {
            0% {
                background-position: 0% 100%, 50% 100%, 100% 100%
            }

            100% {
                background-position: 0% 0%, 50% 0%, 100% 0%
            }
        }
    </style>
</head>
<body class="h-full bg-gray-50 text-gray-900 font-montserrat">
    <div class="flex h-full">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <div class="p-6 flex items-center space-x-3 border-b border-gray-200">
                <div class="w-20 h-12 rounded-md overflow-hidden">
                    <img src="../assets/logoo.png" alt="QC Library Logo" class="w-full h-full object-fill" />
                </div>
                <div>
                    <h1 class="text-lg font-semibold text-gray-900">QC Library</h1>
                    <p class="text-sm text-gray-500">Digital Signage</p>
                </div>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="#" id="tab-overview" class="flex items-center px-3 py-2 rounded-md text-primary bg-primary/20 hover:bg-primary/30">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
                    Dashboard
                </a>
                <a href="#" id="logout-btn" class="flex items-center px-3 py-2 rounded-md text-secondary hover:bg-gray-100">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                    Log Out
                </a>
            </nav>
            <div class="p-6 border-t border-gray-200 text-sm text-gray-500">
                <p>Branch Info</p>
                <p id="branch-info" class="mt-1 font-semibold text-gray-700">Main Branch</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 overflow-auto">
            <header class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold">Dashboard</h2>
                    <p class="text-gray-600" id="welcome-msg"</p>
                </div>
                <button id="preview-signage" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-700">Preview Signage</button>
            </header>

            <!-- Tabs -->
            <div class="mb-6 border border-gray-300 rounded bg-white flex overflow-hidden">
                <button id="tab-btn-overview" class="flex-1 py-2 px-4 bg-primary text-white flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
                    <span>Overview</span>
                </button>
                <button id="tab-btn-videos" class="flex-1 py-2 px-4 flex items-center justify-center space-x-2 hover:bg-red-100 text-red-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14v-4zM4 6h10a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z"/></svg>
                    <span>Videos</span>
                </button>
                <button id="tab-btn-announcements" class="flex-1 py-2 px-4 flex items-center justify-center space-x-2 hover:bg-blue-100 text-blue-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14v-4zM4 6h10a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z"/></svg>
                    <span>Announcements</span>
                </button>
                <button id="tab-btn-books" class="flex-1 py-2 px-4 flex items-center justify-center space-x-2 hover:bg-yellow-100 text-yellow-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20l9-5-9-5-9 5 9 5z"/></svg>
                    <span>Featured Books</span>
                </button>
                <button id="tab-btn-footer" class="flex-1 py-2 px-4 flex items-center justify-center space-x-2 hover:bg-gray-200 text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
                    <span>Footer</span>
                </button>
            </div>

            <!-- Tab Contents -->
            <section id="tab-overview-content" class="tab-content bg-white p-6 rounded shadow">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-gray-50 p-4 rounded shadow flex items-center justify-between">
                        <div>
                            <p class="text-2xl font-bold text-gray-900" id="count-videos">0</p>
                            <p class="text-gray-600">Videos</p>
                        </div>
                        <div class="bg-red-100 p-2 rounded">
                            <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14v-4zM4 6h10a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z"/></svg>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded shadow flex items-center justify-between">
                        <div>
                            <p class="text-2xl font-bold text-gray-900" id="count-announcements">0</p>
                            <p class="text-gray-600">Announcements</p>
                        </div>
                        <div class="bg-blue-100 p-2 rounded">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14v-4zM4 6h10a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2z"/></svg>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded shadow flex items-center justify-between">
                        <div>
                            <p class="text-2xl font-bold text-gray-900" id="count-books">0</p>
                            <p class="text-gray-600">Books</p>
                        </div>
                        <div class="bg-yellow-100 p-2 rounded">
                            <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 20l9-5-9-5-9 5 9 5z"/></svg>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded shadow flex items-center justify-between">
                        <div>
                            <p class="text-2xl font-bold text-gray-900" id="count-footers">0</p>
                            <p class="text-gray-600">Footers</p>
                        </div>
                        <div class="bg-gray-200 p-2 rounded text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded shadow">
                    <p class="text-gray-900">You are managing <span id="summary-videos">0 video(s)</span>, <span id="summary-announcements">0 announcement(s)</span>, and <span id="summary-books">0 book(s)</span> for this branch.</p>
                    <p class="text-gray-900">Click on a category above to manage its content.</p>
                </div>
            </section>

            <section id="tab-videos-content" class="tab-content hidden bg-white p-6 rounded shadow">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-danger">Featured Videos</h3>
                    <button id="upload-video-btn" class="bg-danger text-white px-4 py-2 rounded hover:bg-red-700">Upload Video</button>
                </div>
                <form id="upload-video-form" class="mb-6 hidden space-y-4">
                    <div>
                        <label for="video-title" class="block font-medium text-gray-700">Title *</label>
                        <input type="text" id="video-title" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                    </div>
                    <div>
                        <label for="video-description" class="block font-medium text-gray-700">Description</label>
                        <textarea id="video-description" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900"></textarea>
                    </div>
                    <div>
                        <label for="video-duration" class="block font-medium text-gray-700">Duration *</label>
                        <div class="flex space-x-2">
                            <input type="number" id="video-duration" min="1" class="flex-1 border border-gray-300 rounded p-2 bg-white text-gray-900" />
                            <select id="video-duration-unit" class="border border-gray-300 rounded p-2 bg-white text-gray-900">
                                <option value="seconds" selected>Seconds</option>
                                <option value="minutes">Minutes</option>
                                <option value="hours">Hours</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="video-active" class="inline-flex items-center space-x-2">
                            <input type="checkbox" id="video-active" class="form-checkbox text-primary" checked />
                            <span>Active</span>
                        </label>
                    </div>
                    <div>
                        <label for="video-loop" class="inline-flex items-center space-x-2">
                            <input type="checkbox" id="video-loop" class="form-checkbox text-primary" />
                            <span>Loop Video</span>
                        </label>
                    </div>
                    <div>
                        <label for="video-expiry" class="block font-medium text-gray-700">Expiry Date</label>
                        <input type="date" id="video-expiry" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                    </div>
                    <div>
                        <label for="video-pin" class="inline-flex items-center space-x-2">
                            <input type="checkbox" id="video-pin" class="form-checkbox text-primary" />
                            <span>Pin Video</span>
                        </label>
                    </div>
                    <div>
                        <label for="video-file" class="block font-medium text-gray-700">Video File *</label>
                        <input type="file" id="video-file" accept="video/*" class="w-full" />
                    </div>
                    <div class="space-x-4">
                        <button type="submit" class="bg-danger text-white px-4 py-2 rounded hover:bg-red-700">Upload & Save</button>
                        <button type="button" id="cancel-upload-video" class="text-gray-600 hover:underline">Cancel</button>
                    </div>
                </form>
                <div id="videos-list" class="space-y-4">
                    <p class="text-gray-500">No videos yet</p>
                    <!-- Removed Upload First Video button as requested -->
                    <!-- <button id="upload-first-video" class="bg-danger text-white px-4 py-2 rounded hover:bg-red-700">Upload First Video</button> -->
                </div>
            </section>

            <section id="tab-announcements-content" class="tab-content hidden bg-white p-6 rounded shadow">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-blue-600">Announcements</h3>
                    <button id="new-announcement-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ New</button>
                </div>
                <form id="new-announcement-form" class="mb-6 hidden space-y-4">
                    <div>
                        <label for="announcement-title" class="block font-medium text-gray-700">Title *</label>
                        <input type="text" id="announcement-title" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                    </div>
                    <div>
                        <label for="announcement-content" class="block font-medium text-gray-700">Announcement *</label>
                        <textarea id="announcement-content" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900"></textarea>
                    </div>
                    <div>
                        <label for="announcement-duration" class="block font-medium text-gray-700">Duration *</label>
                        <div class="flex space-x-2">
                            <input type="number" id="announcement-duration" min="1" class="flex-1 border border-gray-300 rounded p-2 bg-white text-gray-900" />
                            <select id="announcement-duration-unit" class="border border-gray-300 rounded p-2 bg-white text-gray-900">
                                <option value="seconds" selected>Seconds</option>
                                <option value="minutes">Minutes</option>
                                <option value="hours">Hours</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="announcement-active" class="inline-flex items-center space-x-2">
                            <input type="checkbox" id="announcement-active" class="form-checkbox text-primary" checked />
                            <span>Active</span>
                        </label>
                    </div>
                    <div>
                        <label for="announcement-expiry" class="block font-medium text-gray-700">Expiry Date</label>
                        <input type="date" id="announcement-expiry" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                    </div>
                    <div>
                        <label for="announcement-pin" class="inline-flex items-center space-x-2">
                            <input type="checkbox" id="announcement-pin" class="form-checkbox text-primary" />
                            <span>Pin Announcement</span>
                        </label>
                    </div>
                    <div>
                        <label for="announcement-text-size" class="block font-medium text-gray-700">Text Size</label>
                        <select id="announcement-text-size" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    <div class="space-x-4">
                        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Create & Save</button>
                        <button type="button" id="cancel-new-announcement" class="text-gray-600 hover:underline">Cancel</button>
                    </div>
                </form>
                <div id="announcements-list" class="space-y-4">
                    <p class="text-gray-500">No announcements yet</p>
                </div>
            </section>

            <section id="tab-books-content" class="tab-content hidden bg-white p-6 rounded shadow">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-yellow-600">Featured Books</h3>
                    <button id="add-book-btn" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">+ Add Book</button>
                </div>
                <form id="add-book-form" class="mb-6 hidden space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="book-title" class="block font-medium text-gray-700">Title *</label>
                            <input type="text" id="book-title" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                        </div>
                        <div>
                            <label for="book-author" class="block font-medium text-gray-700">Author *</label>
                            <input type="text" id="book-author" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                        </div>
                        <div>
                            <label for="book-category" class="block font-medium text-gray-700">Category</label>
                            <input type="text" id="book-category" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                        </div>
                        <div class="col-span-2">
                            <label for="book-description" class="block font-medium text-gray-700">Description</label>
                            <textarea id="book-description" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900"></textarea>
                        </div>
                        <div class="col-span-2">
                            <label for="book-expiry" class="block font-medium text-gray-700">Expiry Date</label>
                            <input type="date" id="book-expiry" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                        </div>
                        <div>
                            <label for="book-availability" class="block font-medium text-gray-700">Availability</label>
                            <select id="book-availability" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900">
                                <option value="AVAILABLE" selected>AVAILABLE</option>
                                <option value="BORROWED">BORROWED</option>
                            </select>
                        </div>
                        <div>
                            <label for="book-cover" class="block font-medium text-gray-700">Cover Image *</label>
                            <input type="file" id="book-cover" accept="image/*" class="w-full" />
                        </div>
                    </div>
                    <div class="space-x-4">
                        <button type="submit" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">Add Book</button>
                        <button type="button" id="cancel-add-book" class="text-gray-600 hover:underline">Cancel</button>
                    </div>
                </form>
                <div id="books-list" class="space-y-4">
                    <p class="text-gray-500">No books featured</p>
                </div>
            </section>

            <section id="tab-footer-content" class="tab-content hidden bg-white p-6 rounded shadow">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-600">Footer Ticker Message</h3>
                    <button id="new-footer-msg-btn" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-900">+ New Message</button>
                </div>
                <form id="new-footer-msg-form" class="mb-6 hidden space-y-4">
                    <div>
                        <label for="footer-message" class="block font-medium text-gray-700">Message *</label>
                        <textarea id="footer-message" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900"></textarea>
                    </div>
                    <div>
                        <label for="scroll-speed" class="block font-medium text-gray-700">Scroll Speed: <span id="scroll-speed-value">50</span></label>
                        <input type="range" id="scroll-speed" min="10" max="100" value="50" class="w-full" />
                    </div>
                    <div>
                        <label for="footer-expiry" class="block font-medium text-gray-700">Expiry Date</label>
                        <input type="date" id="footer-expiry" class="w-full border border-gray-300 rounded p-2 bg-white text-gray-900" />
                    </div>
                    <div class="space-x-4">
                        <button type="submit" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-900">Create & Activate</button>
                        <button type="button" id="cancel-new-footer-msg" class="text-gray-600 hover:underline">Cancel</button>
                    </div>
                </form>
                <div id="footer-msgs-list" class="space-y-4">
                    <p class="text-gray-500">No footer messages</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Tab switching logic
        const tabs = ['overview', 'videos', 'announcements', 'books', 'footer'];
        function showTab(tab) {
            tabs.forEach(t => {
                document.getElementById(`tab-${t}-content`).classList.add('hidden');
                document.getElementById(`tab-btn-${t}`).classList.remove('bg-primary', 'text-white');
                document.getElementById(`tab-btn-${t}`).classList.add('hover:bg-gray-200', 'text-gray-600');
            });
            document.getElementById(`tab-${tab}-content`).classList.remove('hidden');
            document.getElementById(`tab-btn-${tab}`).classList.add('bg-primary', 'text-white');
            document.getElementById(`tab-btn-${tab}`).classList.remove('hover:bg-gray-200', 'text-gray-600');
        }
        tabs.forEach(tab => {
            document.getElementById(`tab-btn-${tab}`).addEventListener('click', () => showTab(tab));
        });
        showTab('overview');

        // Load branch info and admin name
        const branch = localStorage.getItem('branch') || 'Main Branch';
        const adminName = localStorage.getItem('adminName') || 'Administrator';
        document.getElementById('branch-info').textContent = branch;
        document.getElementById('welcome-msg').textContent = `Administrator ${adminName} for ${branch}`;

        // Preview signage button
        document.getElementById('preview-signage').addEventListener('click', () => {
            window.open('../index.html', '_blank');
        });

        // Load counts for overview
        function loadCounts() {
            const videos = JSON.parse(localStorage.getItem('videos') || '[]');
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            const books = JSON.parse(localStorage.getItem('books') || '[]');
            const footers = JSON.parse(localStorage.getItem('footers') || '[]');

            document.getElementById('count-videos').textContent = videos.length;
            document.getElementById('count-announcements').textContent = announcements.length;
            document.getElementById('count-books').textContent = books.length;
            document.getElementById('count-footers').textContent = footers.length;

            document.getElementById('summary-videos').textContent = `${videos.length} video(s)`;
            document.getElementById('summary-announcements').textContent = `${announcements.length} announcement(s)`;
            document.getElementById('summary-books').textContent = `${books.length} book(s)`;
        }
        loadCounts();

        // Video upload form handling
        const uploadVideoBtn = document.getElementById('upload-video-btn');
        const uploadVideoForm = document.getElementById('upload-video-form');
        const cancelUploadVideoBtn = document.getElementById('cancel-upload-video');
        const videosList = document.getElementById('videos-list');

        uploadVideoBtn.addEventListener('click', () => {
            uploadVideoForm.classList.remove('hidden');
            uploadVideoBtn.classList.add('hidden');
        });

        cancelUploadVideoBtn.addEventListener('click', () => {
            uploadVideoForm.reset();
            uploadVideoForm.classList.add('hidden');
            uploadVideoBtn.classList.remove('hidden');
        });

        function saveVideos(videos) {
            localStorage.setItem('videos', JSON.stringify(videos));
        }

        function loadVideos() {
            const videos = JSON.parse(localStorage.getItem('videos') || '[]');
            videosList.innerHTML = '';
            if (videos.length === 0) {
                videosList.innerHTML = '<p class="text-gray-500">No videos yet</p>';
                return;
            }
            videos.forEach((video, index) => {
                const videoDiv = document.createElement('div');
                videoDiv.className = 'p-4 border rounded mb-2 bg-gray-100';
                videoDiv.innerHTML = `
                    <h4 class="font-semibold">${video.title}</h4>
                    <p>${video.description}</p>
                    <p>Duration: ${video.duration} seconds</p>
                    <p>Status: ${video.active ? 'Active' : 'Inactive'}</p>
                    <p>Loop: ${video.loop ? 'Yes' : 'No'}</p>
                    <p>Expiry Date: ${video.expiryDate || 'None'}</p>
                    <p>Pinned: ${video.pin ? 'Yes' : 'No'}</p>
                `;
                videosList.appendChild(videoDiv);
            });
        }

        uploadVideoForm.addEventListener('submit', e => {
            e.preventDefault();
            const title = document.getElementById('video-title').value.trim();
            const description = document.getElementById('video-description').value.trim();
            let duration = parseInt(document.getElementById('video-duration').value, 10);
            const durationUnit = document.getElementById('video-duration-unit').value;
            const active = document.getElementById('video-active').checked;
            const loop = document.getElementById('video-loop').checked;
            const expiryDate = document.getElementById('video-expiry').value;
            const pin = document.getElementById('video-pin').checked;
            const fileInput = document.getElementById('video-file');
            const file = fileInput.files[0];

            if (!title) {
                alert('Title is required.');
                return;
            }
            if (!duration || duration <= 0) {
                alert('Duration must be a positive number.');
                return;
            }
            if (!file) {
                alert('Please select a video file.');
                return;
            }

            // Convert duration to seconds based on unit
            if (durationUnit === 'minutes') {
                duration = duration * 60;
            } else if (durationUnit === 'hours') {
                duration = duration * 3600;
            }

            const videos = JSON.parse(localStorage.getItem('videos') || '[]');
            videos.push({
                title,
                description,
                duration,
                active,
                loop,
                expiryDate,
                pin,
                fileName: file.name,
                uploadedAt: new Date().toISOString()
            });
            saveVideos(videos);
            uploadVideoForm.reset();
            uploadVideoForm.classList.add('hidden');
            uploadVideoBtn.classList.remove('hidden');
            loadVideos();
        });

        // Initial load of videos
        loadVideos();

        // Announcement form handling
        const newAnnouncementBtn = document.getElementById('new-announcement-btn');
        const newAnnouncementForm = document.getElementById('new-announcement-form');
        const cancelNewAnnouncementBtn = document.getElementById('cancel-new-announcement');
        const announcementsList = document.getElementById('announcements-list');

        newAnnouncementBtn.addEventListener('click', () => {
            newAnnouncementForm.classList.remove('hidden');
            newAnnouncementBtn.classList.add('hidden');
        });

        cancelNewAnnouncementBtn.addEventListener('click', () => {
            newAnnouncementForm.reset();
            newAnnouncementForm.classList.add('hidden');
            newAnnouncementBtn.classList.remove('hidden');
        });

        function saveAnnouncements(announcements) {
            localStorage.setItem('announcements', JSON.stringify(announcements));
        }

        function loadAnnouncements() {
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            announcementsList.innerHTML = '';
            if (announcements.length === 0) {
                announcementsList.innerHTML = '<p class="text-gray-500">No announcements yet</p>';
                return;
            }
            announcements.forEach((announcement, index) => {
                const announcementDiv = document.createElement('div');
                announcementDiv.className = 'p-4 border rounded mb-2 bg-gray-100';
                announcementDiv.innerHTML = `
                    <h4 class="font-semibold">${announcement.title}</h4>
                    <p>${announcement.content}</p>
                    <p>Duration: ${announcement.duration} seconds</p>
                    <p>Status: ${announcement.active ? 'Active' : 'Inactive'}</p>
                    <p>Expiry Date: ${announcement.expiryDate || 'None'}</p>
                    <p>Pinned: ${announcement.pin ? 'Yes' : 'No'}</p>
                    <p>Text Size: ${announcement.textSize}</p>
                `;
                announcementsList.appendChild(announcementDiv);
            });
        }

        newAnnouncementForm.addEventListener('submit', e => {
            e.preventDefault();
            const title = document.getElementById('announcement-title').value.trim();
            const content = document.getElementById('announcement-content').value.trim();
            let duration = parseInt(document.getElementById('announcement-duration').value, 10);
            const durationUnit = document.getElementById('announcement-duration-unit').value;
            const active = document.getElementById('announcement-active').checked;
            const expiryDate = document.getElementById('announcement-expiry').value;
            const pin = document.getElementById('announcement-pin').checked;
            const textSize = document.getElementById('announcement-text-size').value;

            if (!title) {
                alert('Title is required.');
                return;
            }
            if (!content) {
                alert('Announcement content is required.');
                return;
            }
            if (!duration || duration <= 0) {
                alert('Duration must be a positive number.');
                return;
            }

            // Convert duration to seconds based on unit
            if (durationUnit === 'minutes') {
                duration = duration * 60;
            } else if (durationUnit === 'hours') {
                duration = duration * 3600;
            }

            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            announcements.push({
                title,
                content,
                duration,
                active,
                expiryDate,
                pin,
                textSize,
                createdAt: new Date().toISOString()
            });
            saveAnnouncements(announcements);
            newAnnouncementForm.reset();
            newAnnouncementForm.classList.add('hidden');
            newAnnouncementBtn.classList.remove('hidden');
            loadAnnouncements();
            loadCounts(); // Update counts
        });

        // Initial load of announcements
        loadAnnouncements();

        // Book form handling
        const addBookBtn = document.getElementById('add-book-btn');
        const addBookForm = document.getElementById('add-book-form');
        const cancelAddBookBtn = document.getElementById('cancel-add-book');
        const booksList = document.getElementById('books-list');

        addBookBtn.addEventListener('click', () => {
            addBookForm.classList.remove('hidden');
            addBookBtn.classList.add('hidden');
        });

        cancelAddBookBtn.addEventListener('click', () => {
            addBookForm.reset();
            addBookForm.classList.add('hidden');
            addBookBtn.classList.remove('hidden');
        });

        function saveBooks(books) {
            localStorage.setItem('books', JSON.stringify(books));
        }

        function loadBooks() {
            const books = JSON.parse(localStorage.getItem('books') || '[]');
            booksList.innerHTML = '';
            if (books.length === 0) {
                booksList.innerHTML = '<p class="text-gray-500">No books featured</p>';
                return;
            }
            books.forEach(book => {
                const bookDiv = document.createElement('div');
                bookDiv.className = 'p-4 border rounded mb-2 bg-gray-100';
                bookDiv.innerHTML = `
                    <h4 class="font-semibold">${book.title}</h4>
                    <p>Author: ${book.author}</p>
                    <p>Category: ${book.category}</p>
                    <p>Description: ${book.description}</p>
                    <p>Availability: ${book.availability}</p>
                    <p>Expiry Date: ${book.expiryDate || 'None'}</p>
                `;
                booksList.appendChild(bookDiv);
            });
        }

        addBookForm.addEventListener('submit', e => {
            e.preventDefault();
            const title = document.getElementById('book-title').value.trim();
            const author = document.getElementById('book-author').value.trim();
            const category = document.getElementById('book-category').value.trim();
            const description = document.getElementById('book-description').value.trim();
            const availability = document.getElementById('book-availability').value;
            const coverInput = document.getElementById('book-cover');
            const cover = coverInput.files[0];
            const expiryDate = document.getElementById('book-expiry').value;

            if (!title) {
                alert('Title is required.');
                return;
            }
            if (!author) {
                alert('Author is required.');
                return;
            }
            if (!cover) {
                alert('Cover image is required.');
                return;
            }

            const books = JSON.parse(localStorage.getItem('books') || '[]');
            books.push({
                title,
                author,
                category,
                description,
                availability,
                cover: URL.createObjectURL(cover),
                expiryDate,
                addedAt: new Date().toISOString()
            });
            saveBooks(books);
            addBookForm.reset();
            addBookForm.classList.add('hidden');
            addBookBtn.classList.remove('hidden');
            loadBooks();
            loadCounts();
        });

        // Initial load of books
        loadBooks();

        // Footer message form handling
        const newFooterMsgBtn = document.getElementById('new-footer-msg-btn');
        const newFooterMsgForm = document.getElementById('new-footer-msg-form');
        const cancelNewFooterMsgBtn = document.getElementById('cancel-new-footer-msg');
        const footerMsgsList = document.getElementById('footer-msgs-list');

        newFooterMsgBtn.addEventListener('click', () => {
            newFooterMsgForm.classList.remove('hidden');
            newFooterMsgBtn.classList.add('hidden');
        });

        cancelNewFooterMsgBtn.addEventListener('click', () => {
            newFooterMsgForm.reset();
            newFooterMsgForm.classList.add('hidden');
            newFooterMsgBtn.classList.remove('hidden');
        });

        function saveFooters(footers) {
            localStorage.setItem('footers', JSON.stringify(footers));
        }

        function loadFooters() {
            const footers = JSON.parse(localStorage.getItem('footers') || '[]');
            footerMsgsList.innerHTML = '';
            if (footers.length === 0) {
                footerMsgsList.innerHTML = '<p class="text-gray-500">No footer messages</p>';
                return;
            }
            footers.forEach(footer => {
                const footerDiv = document.createElement('div');
                footerDiv.className = 'p-4 border rounded mb-2 bg-gray-100';
                footerDiv.innerHTML = `
                    <h4 class="font-semibold">${footer.message}</h4>
                    <p>Scroll Speed: ${footer.scrollSpeed}</p>
                    <p>Expiry Date: ${footer.expiryDate || 'None'}</p>
                `;
                footerMsgsList.appendChild(footerDiv);
            });
        }

        newFooterMsgForm.addEventListener('submit', e => {
            e.preventDefault();
            const message = document.getElementById('footer-message').value.trim();
            const scrollSpeed = document.getElementById('scroll-speed').value;
            const expiryDate = document.getElementById('footer-expiry').value;

            if (!message) {
                alert('Message is required.');
                return;
            }

            const footers = JSON.parse(localStorage.getItem('footers') || '[]');
            footers.push({
                message,
                scrollSpeed,
                expiryDate,
                createdAt: new Date().toISOString()
            });
            saveFooters(footers);
            newFooterMsgForm.reset();
            newFooterMsgForm.classList.add('hidden');
            newFooterMsgBtn.classList.remove('hidden');
            loadFooters();
            loadCounts();
        });

        // Initial load of footers
        loadFooters();

        // Update scroll speed value display
        document.getElementById('scroll-speed').addEventListener('input', (e) => {
            document.getElementById('scroll-speed-value').textContent = e.target.value;
        });

        // Logout functionality with confirmation popup
        document.getElementById('logout-btn').addEventListener('click', () => {
            // Create confirmation popup elements
            const overlay = document.createElement('div');
            overlay.id = 'logout-overlay';
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100vw';
            overlay.style.height = '100vh';
            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            overlay.style.display = 'flex';
            overlay.style.justifyContent = 'center';
            overlay.style.alignItems = 'center';
            overlay.style.zIndex = '1000';

            const popup = document.createElement('div');
            popup.style.backgroundColor = 'white';
            popup.style.padding = '30px';
            popup.style.borderRadius = '12px';
            popup.style.boxShadow = '0 2px 15px rgba(0,0,0,0.4)';
            popup.style.textAlign = 'center';
            popup.style.width = '350px';

            const message = document.createElement('p');
            message.textContent = 'Are you sure you want to log out?';
            message.style.marginBottom = '25px';
            message.style.fontSize = '18px';
            message.style.fontWeight = '600';

            const btnContainer = document.createElement('div');
            btnContainer.style.display = 'flex';
            btnContainer.style.justifyContent = 'space-around';

            const yesBtn = document.createElement('button');
            yesBtn.textContent = 'Yes';
            yesBtn.style.backgroundColor = '#dc2626'; // red
            yesBtn.style.color = 'white';
            yesBtn.style.border = 'none';
            yesBtn.style.padding = '14px 28px';
            yesBtn.style.borderRadius = '6px';
            yesBtn.style.cursor = 'pointer';
            yesBtn.style.fontSize = '16px';
            yesBtn.style.fontWeight = '600';

            const noBtn = document.createElement('button');
            noBtn.textContent = 'No';
            noBtn.style.backgroundColor = '#6b7280'; // gray
            noBtn.style.color = 'white';
            noBtn.style.border = 'none';
            noBtn.style.padding = '14px 28px';
            noBtn.style.borderRadius = '6px';
            noBtn.style.cursor = 'pointer';
            noBtn.style.fontSize = '16px';
            noBtn.style.fontWeight = '600';

            btnContainer.appendChild(yesBtn);
            btnContainer.appendChild(noBtn);
            popup.appendChild(message);
            popup.appendChild(btnContainer);
            overlay.appendChild(popup);
            document.body.appendChild(overlay);

            yesBtn.addEventListener('click', () => {
                // Clear the overlay
                document.body.removeChild(overlay);
                // Show loader centered on screen
                const loader = document.createElement('div');
                loader.className = 'loader';
                document.body.innerHTML = '';
                document.body.style.display = 'flex';
                document.body.style.justifyContent = 'center';
                document.body.style.alignItems = 'center';
                document.body.style.height = '100vh';
                document.body.appendChild(loader);
                // Simulate delay and redirect
                setTimeout(() => {
                    localStorage.clear();
                    window.location.href = 'login.html';
                }, 5000);
            });

            noBtn.addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
        });
    </script>
</body>
</html>
